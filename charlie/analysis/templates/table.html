<table id="opinion_table" class="display" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>Index</th>
                <th>Country</th>
                <th>RStation</th>
                <th>SMS</th>
                <th>Opinion</th>
            </tr>
        </thead>
 
        <tfoot>
            <tr>
                <th>Index</th>
                <th>Country</th>
                <th>RStation</th>
                <th>SMS</th>
                <th>Opinion</th>
            </tr>
        </tfoot>
 
        <tbody>
            {% for sms in data %}
            <tr>
                <td>{{sms.Index}}</td>
                <td>{{sms.Country}}</td>
                <td>{{sms.RStation}}</td>
                <td>{{sms.SMS}}</td>
                <td><select size="1" id="op_{{sms.Index}}" class='option_selection'>
                    
                    {% for opinion in opinions %}
                        {% if opinion == sms.opinion %}
                            <option value="{{opinion}}" selected>
                                {{opinion}}
                            </option>
                        {% else %}
                            <option value="{{opinion}}">
                                {{opinion}}
                            </option>
                        {% endif %}                            
                    {% endfor %}
                </select></td>
            </tr>
            {% endfor %}
        </tbody>
</table>

<script>
    //var table = $('#opinion_table').dataTable();
    var table = $('#opinion_table').dataTable();

    function applyFiltersToTables(countries, rstations, opinions) {   
        // Create an "OR" regex from the concatenated lists of countries/stations.
        countries = countries.map(function(e) {
            return '('+e+')';
        })
        rstations = rstations.map(function(e) {
            return '('+e+')';
        })
        opinions = opinions.map(function(e) {
            return '('+e+')';
        })
        // TODO(Daria): This is a bit hacky, clear table instead if one of the lists is empty.
        var country_filter = (countries.length > 0) ? countries.join('|') : "nonexistentcountry";
        var rstation_filter = (rstations.length > 0) ? rstations.join('|') : "nonexistentcountry";
        var opinion_filter = (opinions.length > 0) ? opinions.join('|') : "nonexistentcountry";
        console.log(opinion_filter); 
        yadcf.init(myTable, [
        {column_number : 1},
        {column_number : 1, filter_type: "range_number_slider", filter_container_id: "external_filter_container"},
        {column_number : 2, data: ["Yes", "No"], filter_default_label: "Select Yes/No"},
        {column_number : 3, filter_type: "auto_complete", text_data_delimiter: ","},
        {column_number : 4, column_data_type: "html", html_data_type: "text", filter_default_label: "Select tag"}]);
       // table.fnFilter(country_filter, 1 /* column */, true /* as_regex */);
        //table.fnFilter(rstation_filter, 2 /* column */, true /* as_regex */);
        //table.yadcf([{column_number:0}])
        //table.fnFilter(opinion_filter, 4 /* column */, true /* as_regex */);
    }

    
    /*
    function applyFiltersToTables(countries, rstations, opinions) {   
        // Create an "OR" regex from the concatenated lists of countries/stations.
        countries = countries.map(function(e) {
            return '('+e+')';
        })
        rstations = rstations.map(function(e) {
            return '('+e+')';
        })
        opinions = opinions.map(function(e) {
            return '('+e+')';
        })
        // TODO(Daria): This is a bit hacky, clear table instead if one of the lists is empty.
        var country_filter = (countries.length > 0) ? countries.join('|') : "nonexistentcountry";
        var rstation_filter = (rstations.length > 0) ? rstations.join('|') : "nonexistentcountry";
        var opinion_filter = (opinions.length > 0) ? opinions.join('|') : "nonexistentcountry";
        console.log(opinion_filter); */
       // table.fnFilter(country_filter, 1 /* column */, true /* as_regex */);
        //table.fnFilter(rstation_filter, 2 /* column */, true /* as_regex */);
        //table.yadcf([{column_number:0}])
        //table.fnFilter(opinion_filter, 4 /* column */, true /* as_regex */);
    //}

    $('select').on('change', function() {
            id = this.id
            index = id.split('_')[1]
            opinion = this.value
            console.log("post is working!") // sanity check
            $.ajax({
                url : "update/", // the endpoint
                type : "POST", // http method
                data : { "index" : index,
                         "opinion": opinion 
                        }, // data sent with the post request

                // handle a successful response
                success : function(json) {
                    $('#post-text').val(''); // remove the value from the input
                    console.log(json); // log the returned json to the console
                    console.log("success"); // another sanity check
                },

                // handle a non-successful response
                error : function(xhr,errmsg,err) {
                    $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                        " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
                    console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
                }
            });
        });

</script>